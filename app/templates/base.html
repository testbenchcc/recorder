<!doctype html>
<html lang="en" data-webtui-theme="catppuccin">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Recorder{% endblock %}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      :root {
        --base: #1e1e2e;
        --surface0: #313244;
        --surface1: #45475a;
        --surface2: #585b70;
        --text: #cdd6f4;
        --subtext1: #bac2de;
        --overlay2: #9399b2;
        --bg-primary: var(--base);
        --bg-secondary: var(--surface0);
        --bg-tertiary: var(--surface2);
        --text-primary: var(--text);
        --text-secondary: var(--subtext1);
        --text-muted: var(--overlay2);
        --border-color: var(--surface1);
        --accent-start: #c86b23;
        --accent-end: #f39237;
        --accent-soft-15: rgba(200, 107, 35, 0.15);
        --accent-soft-20: rgba(200, 107, 35, 0.2);
        --accent-soft-25: rgba(200, 107, 35, 0.25);
        --accent-soft-30: rgba(200, 107, 35, 0.3);
        --accent-soft-50: rgba(200, 107, 35, 0.5);
        --purple-start: var(--accent-start);
        --purple-end: var(--accent-end);
        --card-bg: var(--surface0);
        --input-bg: var(--surface1);
        /* Catppuccin-style base tokens mapped onto our palette */
      }

      [data-webtui-theme|=catppuccin] {
        --background0: var(--base);
        --background1: var(--surface0);
        --background2: var(--surface1);
        --background3: var(--surface2);
        --foreground0: var(--text);
        --foreground1: var(--subtext1);
        --foreground2: var(--overlay2);
      }

      body {
        background-color: var(--bg-primary) !important;
        color: var(--text-primary) !important;
      }

      .bg-light {
        background-color: var(--bg-secondary) !important;
      }

      .navbar-dark {
        background: linear-gradient(135deg, var(--purple-start) 0%, var(--purple-end) 100%) !important;
      }

      .card {
        background-color: var(--card-bg) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }

      .card-header {
        background: linear-gradient(135deg, var(--purple-start) 0%, var(--purple-end) 100%) !important;
        border-color: var(--border-color) !important;
        color: white !important;
        font-weight: 600;
      }

      .form-control, .form-select {
        background-color: var(--input-bg) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }

      .form-control:focus, .form-select:focus {
        background-color: var(--input-bg) !important;
        border-color: var(--purple-start) !important;
        color: var(--text-primary) !important;
        box-shadow: 0 0 0 0.25rem var(--accent-soft-25) !important;
      }

      .form-control::placeholder {
        color: var(--text-muted) !important;
      }

      .text-muted {
        color: var(--text-muted) !important;
      }

      .border {
        border-color: var(--border-color) !important;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--purple-start) 0%, var(--purple-end) 100%) !important;
        border: none !important;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #e07d2a 0%, #ffb562 100%) !important;
        transform: translateY(-1px);
      }

      .btn-outline-primary {
        border-color: var(--purple-start) !important;
        color: var(--purple-start) !important;
      }

      .btn-outline-primary:hover {
        background-color: var(--purple-start) !important;
        color: white !important;
      }

      .btn-outline-secondary {
        border-color: var(--text-secondary) !important;
        color: var(--text-secondary) !important;
      }

      .btn-outline-secondary:hover {
        background-color: var(--text-secondary) !important;
        color: var(--bg-primary) !important;
      }

      .modal-content {
        background-color: var(--card-bg) !important;
        border-color: var(--border-color) !important;
      }

      .modal-header {
        background: linear-gradient(135deg, var(--purple-start) 0%, var(--purple-end) 100%) !important;
        border-color: var(--border-color) !important;
        color: white !important;
      }

      .modal-footer {
        border-color: var(--border-color) !important;
      }

      .bg-white {
        background-color: var(--card-bg) !important;
      }

      .dropdown-menu {
        background-color: var(--card-bg) !important;
        border-color: var(--border-color) !important;
      }

      .dropdown-item {
        color: var(--text-primary) !important;
      }

      .dropdown-item:hover {
        background-color: var(--input-bg) !important;
      }

      .form-check-input {
        background-color: var(--input-bg) !important;
        border-color: var(--border-color) !important;
      }

      .form-check-input:checked {
        background-color: var(--purple-start) !important;
        border-color: var(--purple-start) !important;
      }

      .form-text {
        color: var(--text-muted) !important;
      }

      .badge {
        font-weight: 500;
      }

      code {
        background-color: var(--input-bg) !important;
        color: var(--purple-start) !important;
        padding: 0.2em 0.4em;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Recorder</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#mainNavbar"
          aria-controls="mainNavbar"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainNavbar">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/recordings/view">Recordings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/config/view">Configuration</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main>
      {% block content %}{% endblock %}
    </main>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script>
      (function () {
        async function applyThemeFromConfig() {
          try {
            const res = await fetch("/ui/config", { cache: "no-store" });
            if (!res.ok) return;
            const data = await res.json();
            const theme = (data && data.theme) || {};
            const root = document.documentElement;
            const styles = getComputedStyle(root);

            function pick(name, fallback) {
              const value = theme[name];
              if (typeof value === "string" && value.trim()) return value.trim();
              return fallback;
            }

            const base = pick("base", styles.getPropertyValue("--base").trim());
            const surface0 = pick(
              "surface0",
              styles.getPropertyValue("--surface0").trim(),
            );
            const surface1 = pick(
              "surface1",
              styles.getPropertyValue("--surface1").trim(),
            );
            const surface2 = pick(
              "surface2",
              styles.getPropertyValue("--surface2").trim(),
            );
            const text = pick("text", styles.getPropertyValue("--text").trim());
            const subtext1 = pick(
              "subtext1",
              styles.getPropertyValue("--subtext1").trim(),
            );
            const overlay2 = pick(
              "overlay2",
              styles.getPropertyValue("--overlay2").trim(),
            );

            const accentStart = pick(
              "accent_start",
              styles.getPropertyValue("--accent-start").trim() ||
                styles.getPropertyValue("--purple-start").trim(),
            );
            const accentEnd = pick(
              "accent_end",
              styles.getPropertyValue("--accent-end").trim() ||
                styles.getPropertyValue("--purple-end").trim(),
            );

            root.style.setProperty("--base", base);
            root.style.setProperty("--surface0", surface0);
            root.style.setProperty("--surface1", surface1);
            root.style.setProperty("--surface2", surface2);
            root.style.setProperty("--text", text);
            root.style.setProperty("--subtext1", subtext1);
            root.style.setProperty("--overlay2", overlay2);

            root.style.setProperty("--bg-primary", base);
            root.style.setProperty("--bg-secondary", surface0);
            root.style.setProperty("--bg-tertiary", surface2);
            root.style.setProperty("--text-primary", text);
            root.style.setProperty("--text-secondary", subtext1);
            root.style.setProperty("--text-muted", overlay2);
            root.style.setProperty("--border-color", surface1);
            root.style.setProperty("--card-bg", surface0);
            root.style.setProperty("--input-bg", surface1);

            root.style.setProperty("--accent-start", accentStart);
            root.style.setProperty("--accent-end", accentEnd);
            root.style.setProperty("--purple-start", accentStart);
            root.style.setProperty("--purple-end", accentEnd);

            function hexToRgb(hex) {
              if (typeof hex !== "string") return null;
              const cleaned = hex.trim().replace(/^#/, "");
              if (cleaned.length === 3) {
                const r = cleaned[0];
                const g = cleaned[1];
                const b = cleaned[2];
                return {
                  r: parseInt(r + r, 16),
                  g: parseInt(g + g, 16),
                  b: parseInt(b + b, 16),
                };
              }
              if (cleaned.length === 6) {
                return {
                  r: parseInt(cleaned.slice(0, 2), 16),
                  g: parseInt(cleaned.slice(2, 4), 16),
                  b: parseInt(cleaned.slice(4, 6), 16),
                };
              }
              return null;
            }

            const rgb = hexToRgb(accentStart);
            if (rgb) {
              const { r, g, b } = rgb;
              root.style.setProperty(
                "--accent-soft-15",
                `rgba(${r}, ${g}, ${b}, 0.15)`,
              );
              root.style.setProperty(
                "--accent-soft-20",
                `rgba(${r}, ${g}, ${b}, 0.2)`,
              );
              root.style.setProperty(
                "--accent-soft-25",
                `rgba(${r}, ${g}, ${b}, 0.25)`,
              );
              root.style.setProperty(
                "--accent-soft-30",
                `rgba(${r}, ${g}, ${b}, 0.3)`,
              );
              root.style.setProperty(
                "--accent-soft-50",
                `rgba(${r}, ${g}, ${b}, 0.5)`,
              );
            }
          } catch (err) {
            console.error("Failed to apply theme config", err);
          }
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", applyThemeFromConfig);
        } else {
          applyThemeFromConfig();
        }
      })();
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
