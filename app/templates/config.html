{% extends "base.html" %}

{% block title %}Recorder – Configuration{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div id="config-messages" class="mb-3"></div>
    <form id="config-form" class="d-flex flex-column gap-3">
      <div class="card">
        <div class="card-header">Recording light</div>
        <div class="card-body">
          <div class="form-check form-switch mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="light-enabled"
            />
            <label class="form-check-label" for="light-enabled">
              Enable recording light
            </label>
          </div>
          <div class="mb-3">
            <label for="light-brightness" class="form-label">
              Brightness (0–100):
              <span id="light-brightness-value">20</span>
            </label>
            <input
              type="range"
              class="form-range"
              id="light-brightness"
              min="0"
              max="100"
              step="1"
              value="20"
            />
          </div>
          <div class="mb-0">
            <label for="light-color" class="form-label">Color</label>
            <input
              type="color"
              class="form-control form-control-color"
              id="light-color"
              value="#ff0000"
              title="Choose recording light color"
            />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Whisper transcription server</div>
        <div class="card-body">
          <div class="form-check form-switch mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="whisper-enabled"
            />
            <label class="form-check-label" for="whisper-enabled">
              Enable Whisper integration
            </label>
          </div>
          <div class="mb-3">
            <label for="whisper-api-url" class="form-label">
              API server URL
            </label>
            <input
              type="url"
              class="form-control"
              id="whisper-api-url"
              placeholder="http://127.0.0.1:8093"
            />
            <div class="form-text">
              Base URL of your Whisper.cpp server (without the <code>/inference</code> or <code>/load</code> path).
            </div>
          </div>
          <div class="mb-3">
            <label for="whisper-response-format" class="form-label">
              Default response format
            </label>
            <select
              class="form-select"
              id="whisper-response-format"
            >
              <option value="json">json</option>
              <option value="text">text</option>
              <option value="srt">srt</option>
              <option value="vtt">vtt</option>
              <option value="vad_sequential">VAD + Sequential</option>
            </select>
            <div class="form-text">
              Must match the <code>response_format</code> supported by your Whisper server.
            </div>
          </div>
          <div class="mb-3">
            <label for="whisper-temperature" class="form-label">
              Default temperature
            </label>
            <input
              type="number"
              step="0.1"
              min="0"
              max="2"
              class="form-control"
              id="whisper-temperature"
            />
            <div class="form-text">
              Maps to the <code>temperature</code> parameter for <code>/inference</code>.
            </div>
          </div>
          <div class="mb-3">
            <label for="whisper-temperature-inc" class="form-label">
              Default temperature increment
            </label>
            <input
              type="number"
              step="0.1"
              min="0"
              max="2"
              class="form-control"
              id="whisper-temperature-inc"
            />
            <div class="form-text">
              Maps to the <code>temperature_inc</code> parameter for <code>/inference</code>.
            </div>
          </div>
          <div class="mb-0">
            <label for="whisper-model-path" class="form-label">
              Default model path
            </label>
            <input
              type="text"
              class="form-control"
              id="whisper-model-path"
              placeholder="/path/to/model.bin"
            />
            <div class="form-text">
              Optional default path for the model to load via the <code>/load</code> endpoint.
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">VAD segmentation</div>
        <div class="card-body">
          <div class="mb-3">
            <label for="vad-threshold" class="form-label">
              VAD threshold
            </label>
            <input
              type="number"
              step="0.01"
              min="0"
              max="1"
              class="form-control"
              id="vad-threshold"
            />
            <div class="form-text">
              Maps to <code>--vad-threshold</code>. Higher values produce fewer, more confident speech segments.
            </div>
          </div>
          <div class="mb-3">
            <label for="vad-min-silence-ms" class="form-label">
              Min silence duration (ms)
            </label>
            <input
              type="number"
              min="0"
              class="form-control"
              id="vad-min-silence-ms"
            />
            <div class="form-text">
              Maps to <code>--vad-min-silence-duration-ms</code>. Increase to avoid splitting on very short pauses.
            </div>
          </div>
          <div class="mb-3">
            <label for="vad-max-speech-seconds" class="form-label">
              Max speech duration (seconds)
            </label>
            <input
              type="number"
              step="0.5"
              min="0"
              class="form-control"
              id="vad-max-speech-seconds"
            />
            <div class="form-text">
              Maps to <code>--vad-max-speech-duration-s</code>. Longer values allow bigger segments before auto-split.
            </div>
          </div>
          <div class="mb-3">
            <label for="vad-speech-pad-ms" class="form-label">
              Speech padding (ms)
            </label>
            <input
              type="number"
              min="0"
              class="form-control"
              id="vad-speech-pad-ms"
            />
            <div class="form-text">
              Maps to <code>--vad-speech-pad-ms</code>. Adds padding before/after detected speech.
            </div>
          </div>
          <div class="mb-0">
            <label for="vad-samples-overlap" class="form-label">
              Samples overlap (seconds)
            </label>
            <input
              type="number"
              step="0.01"
              min="0"
              max="1"
              class="form-control"
              id="vad-samples-overlap"
            />
            <div class="form-text">
              Maps to <code>--vad-samples-overlap</code>. Controls overlap between analysis windows.
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-0">
        <div class="card-header">Recording defaults</div>
        <div class="card-body">
          <div class="mb-3">
            <label for="default-max-duration-seconds" class="form-label">
              Default max duration (seconds)
            </label>
            <input
              type="number"
              class="form-control"
              id="default-max-duration-seconds"
              min="1"
            />
            <div class="form-text">
              This value is pre-filled on the home page and used when starting a new recording.
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Save configuration</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/config.js"></script>
{% endblock %}
