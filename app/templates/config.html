{% extends "base.html" %}

{% block title %}Recorder – Configuration{% endblock %}

{% block content %}
<div class="container-fluid px-3 py-3">
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <div class="d-flex flex-column flex-grow-1">
      <h4 class="mb-0">Configuration</h4>
      <div id="config-messages" class="mt-2"></div>
    </div>
    <button
      type="submit"
      class="btn btn-sm btn-primary"
      form="config-form"
    >
      Save configuration
    </button>
  </div>
  <form id="config-form">
    <div style="column-count: 1; column-gap: 1rem;">
      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">Recording light</div>
        <div class="card-body">
          <div class="form-check form-switch mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="light-enabled"
            />
            <label class="form-check-label" for="light-enabled">
              Enable recording light
            </label>
          </div>
          <div class="mb-3">
            <label for="light-brightness" class="form-label small">
              Brightness (0–100):
              <span id="light-brightness-value">20</span>
            </label>
            <input
              type="range"
              class="form-range"
              id="light-brightness"
              min="0"
              max="100"
              step="1"
              value="20"
            />
          </div>
          <div class="mb-0">
            <label for="light-color" class="form-label small">Color</label>
            <input
              type="color"
              class="form-control form-control-color"
              id="light-color"
              value="#ff0000"
              title="Choose recording light color"
            />
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">Recording defaults</div>
        <div class="card-body">
          <div class="mb-3">
            <label for="default-max-duration-seconds" class="form-label small">
              Default max duration (seconds)
            </label>
            <input
              type="number"
              class="form-control form-control-sm"
              id="default-max-duration-seconds"
              min="1"
            />
            <div class="form-text">
              This value is pre-filled on the home page and used when starting a new recording.
            </div>
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">Theme</div>
        <div class="card-body">
          <div class="mb-2 small text-muted">
            Configure the primary UI colors. Changes take effect after saving and reloading the page.
          </div>
          <div class="row row-cols-1 row-cols-sm-2 g-2">
            <div class="col">
              <div class="mb-2">
                <label for="theme-base" class="form-label small">Base background</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-base"
                  value="#1e1e2e"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-2">
                <label for="theme-surface0" class="form-label small">Surface 0 (cards)</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-surface0"
                  value="#313244"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-2">
                <label for="theme-surface1" class="form-label small">Surface 1 (inputs)</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-surface1"
                  value="#45475a"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-2">
                <label for="theme-surface2" class="form-label small">Surface 2</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-surface2"
                  value="#585b70"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-2">
                <label for="theme-text" class="form-label small">Text</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-text"
                  value="#cdd6f4"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-2">
                <label for="theme-subtext1" class="form-label small">Subtext 1</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-subtext1"
                  value="#bac2de"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-0">
                <label for="theme-overlay2" class="form-label small">Overlay 2</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-overlay2"
                  value="#9399b2"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-0 mt-2 mt-sm-0">
                <label for="theme-accent-start" class="form-label small">Accent start</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-accent-start"
                  value="#c86b23"
                />
              </div>
            </div>
            <div class="col">
              <div class="mb-0 mt-2 mt-sm-0">
                <label for="theme-accent-end" class="form-label small">Accent end</label>
                <input
                  type="color"
                  class="form-control form-control-color"
                  id="theme-accent-end"
                  value="#f39237"
                />
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">Whisper transcription server</div>
        <div class="card-body">
          <div class="form-check form-switch mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="whisper-enabled"
            />
            <label class="form-check-label" for="whisper-enabled">
              Enable Whisper integration
            </label>
          </div>
          <div class="mb-3">
            <label for="whisper-api-url" class="form-label small">
              API server URL
            </label>
            <input
              type="url"
              class="form-control form-control-sm"
              id="whisper-api-url"
              placeholder="http://127.0.0.1:8093"
            />
            <div class="form-text">
              Base URL of your Whisper.cpp server (without the <code>/inference</code> or <code>/load</code> path).
            </div>
          </div>
          <div class="mb-3">
            <label for="whisper-response-format" class="form-label small">
              Default response format
            </label>
            <select
              class="form-select form-select-sm"
              id="whisper-response-format"
            >
              <option value="json">json</option>
              <option value="text">text</option>
              <option value="srt">srt</option>
              <option value="vtt">vtt</option>
              <option value="vad_sequential">VAD + Sequential</option>
            </select>
            <div class="form-text">
              Must match the <code>response_format</code> supported by your Whisper server.
            </div>
          </div>
          <div class="mb-3">
            <label for="whisper-temperature" class="form-label small">
              Default temperature
            </label>
            <input
              type="number"
              step="0.1"
              min="0"
              max="2"
              class="form-control form-control-sm"
              id="whisper-temperature"
            />
            <div class="form-text">
              Maps to the <code>temperature</code> parameter for <code>/inference</code>.
            </div>
          </div>
          <div class="mb-3">
            <label for="whisper-temperature-inc" class="form-label small">
              Default temperature increment
            </label>
            <input
              type="number"
              step="0.1"
              min="0"
              max="2"
              class="form-control form-control-sm"
              id="whisper-temperature-inc"
            />
            <div class="form-text">
              Maps to the <code>temperature_inc</code> parameter for <code>/inference</code>.
            </div>
          </div>
          <div class="mb-0">
            <label for="whisper-model-path" class="form-label small">
              Default model path
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="whisper-model-path"
              placeholder="/path/to/model.bin"
            />
            <div class="form-text">
              Optional default path for the model to load via the <code>/load</code> endpoint.
            </div>
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">VAD segmentation</div>
        <div class="card-body">
          <div class="mb-3">
            <label for="vad-threshold" class="form-label small">
              VAD threshold
            </label>
            <input
              type="number"
              step="0.01"
              min="0"
              max="1"
              class="form-control form-control-sm"
              id="vad-threshold"
            />
            <div class="form-text">
              Maps to <code>--vad-threshold</code>. Higher values produce fewer, more confident speech segments.
            </div>
          </div>
          <div class="mb-3">
            <label for="vad-min-silence-ms" class="form-label small">
              Min silence duration (ms)
            </label>
            <input
              type="number"
              min="0"
              class="form-control form-control-sm"
              id="vad-min-silence-ms"
            />
            <div class="form-text">
              Maps to <code>--vad-min-silence-duration-ms</code>. Increase to avoid splitting on very short pauses.
            </div>
          </div>
          <div class="mb-3">
            <label for="vad-max-speech-seconds" class="form-label small">
              Max speech duration (seconds)
            </label>
            <input
              type="number"
              step="0.5"
              min="0"
              class="form-control form-control-sm"
              id="vad-max-speech-seconds"
            />
            <div class="form-text">
              Maps to <code>--vad-max-speech-duration-s</code>. Longer values allow bigger segments before auto-split.
            </div>
          </div>
          <div class="mb-3">
            <label for="vad-speech-pad-ms" class="form-label small">
              Speech padding (ms)
            </label>
            <input
              type="number"
              min="0"
              class="form-control form-control-sm"
              id="vad-speech-pad-ms"
            />
            <div class="form-text">
              Maps to <code>--vad-speech-pad-ms</code>. Adds padding before/after detected speech.
            </div>
          </div>
          <div class="mb-0">
            <label for="vad-samples-overlap" class="form-label small">
              Samples overlap (seconds)
            </label>
            <input
              type="number"
              step="0.01"
              min="0"
              max="1"
              class="form-control form-control-sm"
              id="vad-samples-overlap"
            />
            <div class="form-text">
              Maps to <code>--vad-samples-overlap</code>. Controls overlap between analysis windows.
            </div>
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">Button</div>
        <div class="card-body">
          <div class="mb-0">
            <label for="button-min-interval-sec" class="form-label small">
              Min interval between presses (seconds)
            </label>
            <input
              type="number"
              step="0.1"
              min="0"
              class="form-control form-control-sm"
              id="button-min-interval-sec"
            />
            <div class="form-text">
              Minimum time between button presses to prevent accidental double-presses.
            </div>
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">VAD binary</div>
        <div class="card-body">
          <div class="mb-3">
            <label for="vad-binary-path" class="form-label small">
              VAD binary path
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="vad-binary-path"
              placeholder="/path/to/vad-speech-segments"
            />
            <div class="form-text">
              Full path to the VAD binary executable.
            </div>
          </div>
          <div class="mb-0">
            <label for="vad-binary-model-path" class="form-label small">
              VAD model path
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="vad-binary-model-path"
              placeholder="/path/to/ggml-silero-v6.2.0.bin"
            />
            <div class="form-text">
              Full path to the VAD model file.
            </div>
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">Storage</div>
        <div class="card-body">
          <div class="mb-3">
            <label for="storage-local-root" class="form-label small">
              Local recordings root
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="storage-local-root"
              placeholder="/path/to/local/recordings"
            />
            <div class="form-text">
              Primary local directory for storing recordings.
            </div>
          </div>
          <div class="mb-3">
            <label for="storage-secondary-root" class="form-label small">
              Secondary recordings root
            </label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="storage-secondary-root"
              placeholder="/mnt/smb/recordings"
            />
            <div class="form-text">
              Optional secondary storage location (e.g., network share).
            </div>
          </div>
          <div class="form-check form-switch mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="storage-secondary-enabled"
            />
            <label class="form-check-label" for="storage-secondary-enabled">
              Enable secondary storage
            </label>
          </div>
          <div class="form-check form-switch mb-0">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="storage-keep-local-after-sync"
            />
            <label class="form-check-label" for="storage-keep-local-after-sync">
              Keep local copy after sync
            </label>
          </div>
        </div>
        </div>
      </div>

      <div style="break-inside: avoid; margin-bottom: 1rem;">
        <div class="card">
        <div class="card-header">Debug</div>
        <div class="card-body">
          <div class="form-check form-switch mb-0">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="debug-vad-segments"
            />
            <label class="form-check-label" for="debug-vad-segments">
              Debug VAD segments
            </label>
            <div class="form-text">
              Enable verbose logging for VAD segment detection.
            </div>
          </div>
        </div>
        </div>
      </div>

    </div>
  </form>

  <style>
    @media (min-width: 768px) {
      #config-form > div {
        column-count: 2 !important;
      }
    }
    @media (min-width: 992px) {
      #config-form > div {
        column-count: 3 !important;
      }
    }
  </style>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/config.js"></script>
{% endblock %}
